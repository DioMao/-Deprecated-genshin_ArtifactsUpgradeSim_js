"use strict";function versionCheck(){let t=window.localStorage;return t?null==t.ArtifactsSimVersion?(t.ArtifactsSimVersion=ArtifactsSim.version,!0):t.ArtifactsSimVersion==ArtifactsSim.version||(alert("模拟器版本更新，如果遇到错误，请尝试清除浏览器缓存!"),t.ArtifactsSimVersion=ArtifactsSim.version,!1):(alert("浏览器不支持localstorage"),!1)}class ArtifactConst{constructor(){const t=[7,14.9,22.8,30.8,38.7,46.6],r=[8.7,18.6,28.6,38.5,48.4,58.3];this.__ArtifactConstList__={entryList:["critRate","critDMG","ATK","ATKPer","def","defPer","HP","HPPer","energyRecharge","elementMastery"],entryListCh:["暴击率","暴击伤害","攻击力","攻击力","防御力","防御力","生命值","生命值","元素充能效率","元素精通"],entryProbability:[.3,.3,.75,.5,.75,.5,.75,.5,.3,.3],entryValue:{critRate:[2.7222,3.1111,3.5,3.8889],critDMG:[5.4402,6.2174,7,7.7718],ATK:[13.6111,15.5556,17.5,19.4444],ATKPer:[4.0833,4.6667,5.25,5.8333],def:[16.3333,18.5,21,23.3333],defPer:[5.1031,5.8321,6.5611,7.2901],HP:[209.125,239,268.875,298.75],HPPer:[4.0833,4.6667,5.25,5.8333],energyRecharge:[4.5325,5.18,5.8275,6.475],elementMastery:[16.3333,18.5,21,23.3333]},extraEnrtyRate:.3,parts:["feather","flower","hourglass","hat","cup"],partsCh:["死之羽","生之花","时之沙","理之冠","空之杯"],feather:["ATK"],flower:["HP"],hourglass:["ATKPer","defPer","HPPer","elementMastery","energyRecharge"],hat:["critRate","critDMG","ATKPer","defPer","HPPer","elementMastery","HPRes"],cup:["ATKPer","defPer","HPPer","elementMastery","water","fire","thunder","rock","wind","ice","Physical"],mainEntryList:["ATK","HP","critRate","energyRecharge","HPRes","critDMG","ATKPer","defPer","HPPer","elementMastery","water","fire","thunder","rock","wind","ice","Physical"],mainEntryListCh:["攻击力","生命值","暴击率","元素充能效率","治疗加成","暴击伤害","攻击力","防御力","生命值","元素精通","水元素伤害加成","火元素伤害加成","雷元素伤害加成","岩元素伤害加成","风元素伤害加成","冰元素伤害加成","物理伤害加成"],hourglassRate:[.26,.26,.26,.1,.1],hatRate:[.1,.1,.22,.22,.22,.04,.1],cupRate:[.21,.21,.21,.025,.05,.05,.05,.05,.05,.05,.05],mainEntryValueList:{ATK:[47,100,152,205,258,311],HP:[717,1530,2342,3156,3967,4780],critRate:[4.7,9.9,15.2,20.5,25.8,31.1],energyRecharge:[7.8,16.5,25.4,34.2,43,51.8],HPRes:[5.4,11.5,17.6,23.7,29.8,35.9],critDMG:[9.3,19.9,30.5,41,51.6,62.2],ATKPer:t,defPer:r,HPPer:t,elementMastery:[28,60,91,123,155,187],water:t,fire:t,thunder:t,rock:t,wind:t,ice:t,Physical:r},scoreList:["atk","crit","def","hp","er","em"],scoreListCh:["攻击得分","双暴得分","防御得分","生命得分","充能得分","精通得分"],scoreStandar:{critRate:2,critDMG:1,ATK:.13,ATKPer:1.345,def:.11,defPer:1.07,HP:.0087,HPPer:1.345,energyRecharge:1.2,elementMastery:.339}}}get val(){return this.__ArtifactConstList__}}class ArtifactsFunction_class{constructor(){this.__version__="0.1.7",this.__result__=[],this.count=0,this.history=[],this.backup=[],this.deleteHistory=[],this.__maxResults__=2e3}creatArtifact(t="",r="",e=[],n=[]){if(this.__result__.length>=this.__maxResults__)return console.log(`Warning - The maximum length of the artifacts list is ${this.__maxResults__}.`),!1;let a={level:0,part:"none",mainEntry:"none",mainEntryValue:0,entry:[],initEntry:"",upgradeHistory:[],creationDate:Date.now()},i=[],s=[];"string"==typeof t&&-1!=artiConst.val.parts.indexOf(t)?a.part=t:a.part=artiConst.val.parts[Math.floor(Math.random()*artiConst.val.parts.length)],"string"==typeof r&&-1!=artiConst.val.mainEntryList.indexOf(r)&&this.mainEntryVerify(a.part,r)?a.mainEntry=r:a.mainEntry=this.randomMainEntry(a.part),a.mainEntryValue=artiConst.val.mainEntryValueList[a.mainEntry][0];for(let t=0;t<artiConst.val.entryList.length;t++)artiConst.val.entryList[t]!=a.mainEntry&&(i.push(artiConst.val.entryList[t]),s.push(artiConst.val.entryProbability[t]));if(e.length<=4&&this.entryVerify(a.mainEntry,e))for(let t=0;t<e.length;t++){let r=e[t],o=n[t],l=i.indexOf(r);i.splice(l,1),s.splice(l,1),0!=n.length&&"number"==typeof o&&-1!=artiConst.val.entryValue[r].indexOf(o)||(o=this.randomEntryValue(e)),a.entry.push([r,o])}for(;a.entry.length<3;){let t=this.randomRate(i,s),r=this.randomEntryValue(t),e=i.indexOf(t);i.splice(e,1),s.splice(e,1),a.entry.push([t,r])}if(0==e.length&&Math.random()<artiConst.val.extraEnrtyRate){let t=this.randomRate(i,s);a.entry[3]=[t,this.randomEntryValue(t)]}return a.initEntry=JSON.stringify(a.entry),this.__result__.push(a),this.count++,a}upgrade(t,r="",e=-1){if(t>=this.__result__.length||t<0)return!1;let n=this.__result__[t],a=[],i=[],s=[];if(n.level>=20)return!1;if(n.entry.length<4){for(let t=0;t<n.entry.length;t++)a.push(n.entry[t][0]);for(let t=0;t<artiConst.val.entryList.length;t++)a.indexOf(artiConst.val.entryList[t])<0&&(i.push(artiConst.val.entryList[t]),s.push(artiConst.val.entryProbability[t]));let t=this.randomRate(i,s),r=this.randomEntryValue(t);n.entry.push([t,r]),n.upgradeHistory.push([t,r])}else{let t=0,a="",i=0;if(""!=r&&artiConst.val.entryList.indexOf(r)>=0)for(let e=0;e<n.entry.length;e++)r==n.entry[e][0]&&(t=e,a=n.entry[e][0]);else t=Math.floor(Math.random()*n.entry.length),a=n.entry[t][0];i=-1!=e&&"number"==typeof e&&Math.floor(e)<artiConst.val.entryValue[a].length?artiConst.val.entryValue[a][Math.floor(e)]:this.randomEntryValue(a),n.entry[t][1]+=i,n.upgradeHistory.push([a,i])}return n.level+=4,n.mainEntryValue=artiConst.val.mainEntryValueList[n.mainEntry][n.level/4],!0}ArtifactScore(t,r="default"){if("number"!=typeof t||"string"!=typeof r&&!Array.isArray(r))return 0;if(t>=this.__result__.length||t<0)return 0;let e=0,n=0,a=0,i=0,s=0,o=0,l=0,h=this.__result__[t].entry;for(let t=0;t<h.length;t++){let r=h[t][0],l=h[t][1]*artiConst.val.scoreStandar[r];"ATK"==r||"ATKPer"==r?e+=l:"critRate"==r||"critDMG"==r?n+=l:"def"==r||"defPer"==r?a+=l:"HP"==r||"HPPer"==r?i+=l:"energyRecharge"==r?s+=l:"elementMastery"==r&&(o+=l)}if(Array.isArray(r))for(let t=0;t<r.length;t++)switch(r[t].toLowerCase()){case"atk":l+=e;break;case"crit":l+=n;break;case"def":l+=a;break;case"hp":l+=i;break;case"er":l+=s;break;case"em":l+=o;break;default:l+=0}else switch(r=r.toLowerCase(),r){case"default":return e+n;case"atk":return e;case"crit":return n;case"def":return a;case"hp":return i;case"er":return s;case"em":return o}return l}reset(t){let r=this.__result__[t];r.entry.length=0,r.entry=JSON.parse(r.initEntry),r.upgradeHistory.length=0,r.level=0,r.mainEntryValue=artiConst.val.mainEntryValueList[r.mainEntry][0]}resetAll(){for(let t=0;t<this.__result__.length;t++)this.reset(t)}deleteOne(t){this.deleteHistory.push(this.__result__.splice(t,1)[0]),this.count--}batchDelete(t){t.sort((t,r)=>t-r);for(let r=t.length-1;r>=0;r--)this.deleteHistory.push(this.__result__.splice(t[r],1)[0])}clearAll(){0!=this.backup.length&&(this.backup.length=0),this.backup=JSON.parse(JSON.stringify(this.__result__)),this.__result__.length=0,this.count=0}undoDel(){return 0==this.deleteHistory.length?(console.log("Undo false, history not found."),!1):(this.__result__.push(this.deleteHistory.pop()),!0)}toChinese(t,r){if("string"!=typeof t||"string"!=typeof r)throw new Error("Function toChinese error!Wrong parameter.");return"entry"==r?-1!=artiConst.val.entryList.indexOf(t)&&artiConst.val.entryListCh[artiConst.val.entryList.indexOf(t)]:"parts"==r?-1!=artiConst.val.parts.indexOf(t)&&artiConst.val.partsCh[artiConst.val.parts.indexOf(t)]:"mainEntry"==r?-1!=artiConst.val.mainEntryList.indexOf(t)&&artiConst.val.mainEntryListCh[artiConst.val.mainEntryList.indexOf(t)]:"score"==r&&(-1!=artiConst.val.scoreList.indexOf(t)&&artiConst.val.scoreListCh[artiConst.val.scoreList.indexOf(t)])}entryValFormat(t,r,e="default"){const n=["critRate","critDMG","ATKPer","defPer","HPPer","energyRecharge"],a=["ATK","HP","elementMastery"];return"string"==typeof t&&"string"==typeof e&&("string"==typeof r||"number"==typeof r)&&("main"==e.toLowerCase()?-1!=artiConst.val.mainEntryList.indexOf(t)&&(r=-1!=a.indexOf(t)?this.toThousands(r):Number.parseFloat(r).toFixed(1)+"%",r):-1!=artiConst.val.entryList.indexOf(t)&&(r=-1!=n.indexOf(t)?Number.parseFloat(r).toFixed(1)+"%":this.toThousands(Number.parseFloat(r).toFixed(0)),r))}randomRate(t,r){if(!Array.isArray(t)||!Array.isArray(r))throw new Error("Function RandomRate Warning!Wrong parameter.");if(t.length!=r.length)throw new Error("Function RandomRate Warning!Array length different!");let e=Math.random(),n=0,a=0;for(let t=0;t<r.length;t++)a+=r[t];e*=a;for(let a=0;a<r.length;a++)if(n+=r[a],e<=n)return t[a];return t[t.length-1]}randomMainEntry(t){if("string"!=typeof t)throw new Error("Function randomMainEntry Error!Wrong parameter(Not string).");switch(t){case"feather":return"ATK";case"flower":return"HP";case"hourglass":return this.randomRate(artiConst.val.hourglass,artiConst.val.hourglassRate);case"hat":return this.randomRate(artiConst.val.hat,artiConst.val.hatRate);case"cup":return this.randomRate(artiConst.val.cup,artiConst.val.cupRate);default:return console.log("Error! -randomMainEntry-"),!1}}randomEntryValue(t){if("string"!=typeof t)throw new Error("Function randomEntryValue Error!Wrong parameter(Not string).");return artiConst.val.entryValue[t][Math.floor(Math.random()*artiConst.val.entryValue[t].length)]}mainEntryVerify(t,r){if("string"!=typeof t||"string"!=typeof r)throw new Error("Function mainEntryVerify Error!Wrong parameter(Not string).");return-1!=artiConst.val.parts.indexOf(t)&&-1!=artiConst.val.mainEntryList.indexOf(r)&&-1!=artiConst.val[t].indexOf(r)}entryVerify(t,r){if("string"!=typeof t||!Array.isArray(r))throw new Error("Function entryVerify Error!Wrong parameter.");for(let e=0;e<r.length;e++)if(t==r[e]||-1==artiConst.val.entryList.indexOf(r[e]))return!1;return!0}toThousands(t){return(t||0).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")}get MihoyoImYourDaddy(){for(let t=0;t<this.result.length;t++){const r=this.result[t];for(let e=0;e<r.entry.length;e++){const n=r.entry[e];if("critRate"==n[0]||"critDMG"==n[0])for(;r.level<20;)this.upgrade(t,n[0],3)}}return"Yes,you are!"}get version(){return this.__version__}get result(){return this.__result__}set result(t){Array.isArray(t)&&(t.length>this.__maxResults__&&(t.length=this.__maxResults__,console.log(`Warning - The maximum length of the artifacts list is ${this.__maxResults__}.`)),this.__result__.length=0,this.__result__=t,console.log("%cSet new Artifacts list success.","color:rgb(144,82,41)"))}}const artiConst=new ArtifactConst,ArtifactsSim=new ArtifactsFunction_class;console.log("%cArtifactsUpgradeSim is running.Learn more: https://github.com/DioMao/genshin_ArtifactsUpgradeSim_js","color:rgb(144,82,41)"),versionCheck();