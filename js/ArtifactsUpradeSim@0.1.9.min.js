"use strict";function versionCheck(){let t=window.localStorage,e=t[ArtifactsSim.LSkey];if(!t)throw new Error("The browser does not support LocalStorage.");if(void 0===t.ArtifactsSimVersion)return t.ArtifactsSimVersion=ArtifactsSim.version,!0;if(t.ArtifactsSimVersion!==ArtifactsSim.version)return alert("模拟器版本更新，如果遇到错误，请尝试清除浏览器缓存!"),t.ArtifactsSimVersion=ArtifactsSim.version,!1;if(void 0!==e&&"[]"!==e&&""!==e){try{ArtifactsSim.AUSList=JSON.parse(e)}catch(t){console.log("%cSet new Artifacts list fail.","color:rgb(144,82,41)")}try{ArtifactsSim.AUSList.forEach(t=>{ArtifactsSim.changeCount([t.part,t.mainEntry]),Object.prototype.hasOwnProperty.call(t,"symbol")||(t.symbol=Date.now().toString(36)+"-"+Math.random().toString(36).substring(2)),Object.prototype.hasOwnProperty.call(t,"lock")||(t.lock=!1)})}catch(t){console.log("%cCannot set count.","color:rgb(144,82,41)")}}return!0}class ArtifactConst{constructor(){const t=[7,14.9,22.8,30.8,38.7,46.6],e=[8.7,18.6,28.6,38.5,48.4,58.3];this.__ArtifactConstList__={entryList:["critRate","critDMG","ATK","ATKPer","def","defPer","HP","HPPer","energyRecharge","elementMastery"],entryListCh:["暴击率","暴击伤害","攻击力","攻击力","防御力","防御力","生命值","生命值","元素充能效率","元素精通"],entryProbability:[.3,.3,.75,.5,.75,.5,.75,.5,.3,.3],entryValue:{critRate:[2.7222,3.1111,3.5,3.8889],critDMG:[5.4402,6.2174,7,7.7718],ATK:[13.6111,15.5556,17.5,19.4444],ATKPer:[4.0833,4.6667,5.25,5.8333],def:[16.3333,18.5,21,23.3333],defPer:[5.1031,5.8321,6.5611,7.2901],HP:[209.125,239,268.875,298.75],HPPer:[4.0833,4.6667,5.25,5.8333],energyRecharge:[4.5325,5.18,5.8275,6.475],elementMastery:[16.3333,18.5,21,23.3333]},extraEnrtyRate:.3,parts:["feather","flower","hourglass","hat","cup"],partsCh:["死之羽","生之花","时之沙","理之冠","空之杯"],feather:["ATK"],flower:["HP"],hourglass:["ATKPer","defPer","HPPer","elementMastery","energyRecharge"],hat:["critRate","critDMG","ATKPer","defPer","HPPer","elementMastery","HPRes"],cup:["ATKPer","defPer","HPPer","elementMastery","water","fire","thunder","rock","wind","ice","Physical"],mainEntryList:["ATK","HP","critRate","energyRecharge","HPRes","critDMG","ATKPer","defPer","HPPer","elementMastery","water","fire","thunder","rock","wind","ice","Physical"],mainEntryListCh:["攻击力","生命值","暴击率","元素充能效率","治疗加成","暴击伤害","攻击力","防御力","生命值","元素精通","水元素伤害加成","火元素伤害加成","雷元素伤害加成","岩元素伤害加成","风元素伤害加成","冰元素伤害加成","物理伤害加成"],hourglassRate:[.26,.26,.26,.1,.1],hatRate:[.1,.1,.22,.22,.22,.04,.1],cupRate:[.21,.21,.21,.025,.05,.05,.05,.05,.05,.05,.05],mainEntryValueList:{ATK:[47,100,152,205,258,311],HP:[717,1530,2342,3156,3967,4780],critRate:[4.7,9.9,15.2,20.5,25.8,31.1],energyRecharge:[7.8,16.5,25.4,34.2,43,51.8],HPRes:[5.4,11.5,17.6,23.7,29.8,35.9],critDMG:[9.3,19.9,30.5,41,51.6,62.2],ATKPer:t,defPer:e,HPPer:t,elementMastery:[28,60,91,123,155,187],water:t,fire:t,thunder:t,rock:t,wind:t,ice:t,Physical:e},scoreList:["atk","crit","def","hp","er","em"],scoreListCh:["攻击得分","双暴得分","防御得分","生命得分","充能得分","精通得分"],scoreStandar:{critRate:2,critDMG:1,ATK:.13,ATKPer:1.345,def:.11,defPer:1.07,HP:.0087,HPPer:1.345,energyRecharge:1.2,elementMastery:.339}};const r=()=>{throw new Error("Error!This data is read only!")},n=t=>new Proxy(t,{set:r,defineProperty:r,deleteProperty:r,preventExtensions:r,setPrototypeOf:r});this.__ArtifactConstList__=n(this.__ArtifactConstList__)}get val(){return this.__ArtifactConstList__}}class ArtifactsFunction_class{constructor(){this.__version__="0.1.9",this.__AUSList__=[],this.__deleteHistory__=[],this.__suitList__=[],this.__maxResults__=1e3,this.__localStorageKey__="AUSLocalList",this.__countList__={}}creatArtifact(t="",e="",r=[],n=[]){if(this.__AUSList__.length>=this.__maxResults__)return console.log(`Warning - The maximum length of the artifacts list is ${this.__maxResults__}.`),!1;let i={symbol:"",level:0,part:"none",mainEntry:"none",mainEntryValue:0,entry:[],initEntry:"",upgradeHistory:[],creationDate:Date.now(),lock:!1},a=[],s=[];"string"==typeof t&&-1!==artiConst.val.parts.indexOf(t)?i.part=t:i.part=artiConst.val.parts[Math.floor(Math.random()*artiConst.val.parts.length)],"string"==typeof e&&-1!==artiConst.val.mainEntryList.indexOf(e)&&this.mainEntryVerify(i.part,e)?i.mainEntry=e:i.mainEntry=this.randomMainEntry(i.part),i.mainEntryValue=artiConst.val.mainEntryValueList[i.mainEntry][0];for(let t=0;t<artiConst.val.entryList.length;t++)artiConst.val.entryList[t]!==i.mainEntry&&(a.push(artiConst.val.entryList[t]),s.push(artiConst.val.entryProbability[t]));if(r.length<=4&&this.entryVerify(i.mainEntry,r))for(let t=0;t<r.length;t++){let e=r[t],o=n[t],l=a.indexOf(e);a.splice(l,1),s.splice(l,1),0!==n.length&&"number"==typeof o&&-1!==artiConst.val.entryValue[e].indexOf(o)||(o=this.randomEntryValue(r)),i.entry.push([e,o])}for(;i.entry.length<3;){let t=this.randomRate(a,s),e=this.randomEntryValue(t),r=a.indexOf(t);a.splice(r,1),s.splice(r,1),i.entry.push([t,e])}if(0===r.length&&Math.random()<artiConst.val.extraEnrtyRate){let t=this.randomRate(a,s);i.entry[3]=[t,this.randomEntryValue(t)]}return i.symbol=Date.now().toString(36)+"-"+Math.random().toString(36).substring(2),i.initEntry=JSON.stringify(i.entry),this.__AUSList__.push(i),this.setLocalStorage(this.__localStorageKey__,this.__AUSList__),this.changeCount([i.part,i.mainEntry]),i}upgrade(t,e="",r=-1){if(t>=this.__AUSList__.length||t<0)return!1;let n=this.__AUSList__[t],i=[],a=[],s=[];if(n.level>=20)return!1;if(n.entry.length<4){for(let t=0;t<n.entry.length;t++)i.push(n.entry[t][0]);for(let t=0;t<artiConst.val.entryList.length;t++)i.indexOf(artiConst.val.entryList[t])<0&&(a.push(artiConst.val.entryList[t]),s.push(artiConst.val.entryProbability[t]));let t=this.randomRate(a,s),e=this.randomEntryValue(t);n.entry.push([t,e]),n.upgradeHistory.push([t,e])}else{let t=0,i="",a=0;if(""!==e&&artiConst.val.entryList.indexOf(e)>=0)for(let r=0;r<n.entry.length;r++)e===n.entry[r][0]&&(t=r,i=n.entry[r][0]);else t=Math.floor(Math.random()*n.entry.length),i=n.entry[t][0];a=-1!==r&&"number"==typeof r&&Math.floor(r)<artiConst.val.entryValue[i].length?artiConst.val.entryValue[i][Math.floor(r)]:this.randomEntryValue(i),n.entry[t][1]+=a,n.upgradeHistory.push([i,a])}return n.level+=4,n.mainEntryValue=artiConst.val.mainEntryValueList[n.mainEntry][n.level/4],this.setLocalStorage(this.__localStorageKey__,this.__AUSList__),!0}ArtifactScore(t,e="default"){if("number"!=typeof t||"string"!=typeof e&&!Array.isArray(e))return 0;if(t>=this.__AUSList__.length||t<0)return 0;let r=0,n=0,i=0,a=0,s=0,o=0,l=0,_=this.__AUSList__[t].entry;for(let t=0;t<_.length;t++){let e=_[t][0],l=_[t][1]*artiConst.val.scoreStandar[e];"ATK"===e||"ATKPer"===e?r+=l:"critRate"===e||"critDMG"===e?n+=l:"def"===e||"defPer"===e?i+=l:"HP"===e||"HPPer"===e?a+=l:"energyRecharge"===e?s+=l:"elementMastery"===e&&(o+=l)}if(Array.isArray(e))for(let t=0;t<e.length;t++)switch(e[t].toLowerCase()){case"atk":l+=r;break;case"crit":l+=n;break;case"def":l+=i;break;case"hp":l+=a;break;case"er":l+=s;break;case"em":l+=o;break;default:l+=0}else switch(e=e.toLowerCase(),e){case"default":return r+n;case"atk":return r;case"crit":return n;case"def":return i;case"hp":return a;case"er":return s;case"em":return o}return l}reset(t){let e=this.__AUSList__[t];return!e.lock&&(e.entry.length=0,e.entry=JSON.parse(e.initEntry),e.upgradeHistory.length=0,e.level=0,e.mainEntryValue=artiConst.val.mainEntryValueList[e.mainEntry][0],this.setLocalStorage(this.__localStorageKey__,this.__AUSList__),!0)}resetAll(){for(let t=0;t<this.__AUSList__.length;t++)this.reset(t);this.setLocalStorage(this.__localStorageKey__,this.__AUSList__)}deleteOne(t){let e=this.__AUSList__[t];return!0!==e.lock&&(this.changeCount([e.part,e.mainEntry],-1),this.__deleteHistory__.push(this.__AUSList__.splice(t,1)[0]),this.setLocalStorage(this.__localStorageKey__,this.__AUSList__),!0)}clearAll(){let t=0;for(;t!==this.__AUSList__.length;){let e=this.__AUSList__[t];!1===e.lock?this.__AUSList__.splice(t,1):t++}this.enforceUpdateCount(),this.setLocalStorage(this.__localStorageKey__,this.__AUSList__)}undoDel(){if(0===this.__deleteHistory__.length)return console.log("Undo false, history not found."),!1;let t=this.__deleteHistory__.pop();return this.__AUSList__.push(t),this.changeCount([t.part,t.mainEntry]),this.setLocalStorage(this.__localStorageKey__,this.__AUSList__),!0}changeCount(t,e=1){if("string"!=typeof t&&!Array.isArray(t))return!1;let r=this.__countList__;return"string"==typeof t&&(t=[t]),t.forEach(t=>{Object.prototype.hasOwnProperty.call(r,t)?r[t]=r[t]+e:r[t]=e,r[t]<0&&(r[t]=0)}),!0}enforceUpdateCount(){this.__countList__={},this.__AUSList__.forEach(t=>{this.changeCount([t.part,t.mainEntry])})}lock(t,e="lock"){if("number"==typeof t||"lock"===e||"unlock"===e)return this.__AUSList__.lock="lock"===e,!0}getCount(t){if("string"!=typeof t)return!1;let e=this.__countList__;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:0}sortList(t="lvasc"){if("string"!=typeof t)return!1;"main"===t&&(t="mainEntry");let e=this.__AUSList__;try{e.sort((e,r)=>{if("lvasc"===t||"lvdesc"===t){if(e.level>r.level&&"lvasc"===t||e.level<r.level&&"lvdesc"===t)return 1;if(e.level<r.level&&"lvasc"===t||e.level>r.level&&"lvdesc"===t)return-1;if(e.level===r.level){let t=artiConst.val.parts.indexOf(e.part),n=artiConst.val.parts.indexOf(r.part);if(t>n)return 1;if(t<n)return-1;if(t===n){let t=artiConst.val.mainEntryList.indexOf(e.mainEntry),n=artiConst.val.mainEntryList.indexOf(r.mainEntry);return t>n?1:t<n?-1:0}}}if("part"===t||"mainEntry"===t){let n=e[t].toUpperCase(),i=r[t].toUpperCase();if(n>i)return 1;if(n<i)return-1;if(n===i){if(name_a2>name_b2)return 1;if(name_a2<name_b2)return-1;if(name_a2===name_b2)return e.level>r.level?-1:e.level<r.level?1:0}return 0}}),this.setLocalStorage(this.__localStorageKey__,e)}catch(t){return console.log(t),!1}}searchSymbol(t){for(let e=0;e<this.__AUSList__.length;e++){const r=this.__AUSList__[e];if(r.symbol===t)return e}return-1}newSuit(){}toChinese(t,e){return"string"==typeof t&&"string"==typeof e&&("entry"==e?-1!==artiConst.val.entryList.indexOf(t)&&artiConst.val.entryListCh[artiConst.val.entryList.indexOf(t)]:"parts"===e?-1!==artiConst.val.parts.indexOf(t)&&artiConst.val.partsCh[artiConst.val.parts.indexOf(t)]:"mainEntry"===e?-1!==artiConst.val.mainEntryList.indexOf(t)&&artiConst.val.mainEntryListCh[artiConst.val.mainEntryList.indexOf(t)]:"score"===e&&(-1!==artiConst.val.scoreList.indexOf(t)&&artiConst.val.scoreListCh[artiConst.val.scoreList.indexOf(t)]))}entryValFormat(t,e,r="default"){const n=["critRate","critDMG","ATKPer","defPer","HPPer","energyRecharge"],i=["ATK","HP","elementMastery"];return"string"==typeof t&&"string"==typeof r&&("string"==typeof e||"number"==typeof e)&&("main"===r.toLowerCase()?-1!==artiConst.val.mainEntryList.indexOf(t)&&(e=-1!==i.indexOf(t)?this.toThousands(e):Number.parseFloat(e).toFixed(1)+"%",e):-1!==artiConst.val.entryList.indexOf(t)&&(e=-1!==n.indexOf(t)?Number.parseFloat(e).toFixed(1)+"%":this.toThousands(Number.parseFloat(e).toFixed(0)),e))}randomRate(t,e){if(!Array.isArray(t)||!Array.isArray(e))throw new Error("Function RandomRate Warning!Wrong parameter.");if(t.length!==e.length)throw new Error("Function RandomRate Warning!Array length different!");let r=Math.random(),n=0,i=0;for(let t=0;t<e.length;t++)i+=e[t];r*=i;for(let i=0;i<e.length;i++)if(n+=e[i],r<=n)return t[i];return t[t.length-1]}randomMainEntry(t){if("string"!=typeof t)throw new Error("Function randomMainEntry Error!Wrong parameter(Not string).");switch(t){case"feather":return"ATK";case"flower":return"HP";case"hourglass":return this.randomRate(artiConst.val.hourglass,artiConst.val.hourglassRate);case"hat":return this.randomRate(artiConst.val.hat,artiConst.val.hatRate);case"cup":return this.randomRate(artiConst.val.cup,artiConst.val.cupRate);default:return console.log("Error! -randomMainEntry-"),!1}}randomEntryValue(t){if("string"!=typeof t)throw new Error("Function randomEntryValue Error!Wrong parameter(Not string).");return artiConst.val.entryValue[t][Math.floor(Math.random()*artiConst.val.entryValue[t].length)]}mainEntryVerify(t,e){if("string"!=typeof t||"string"!=typeof e)throw new Error("Function mainEntryVerify Error!Wrong parameter(Not string).");return-1!==artiConst.val.parts.indexOf(t)&&-1!==artiConst.val.mainEntryList.indexOf(e)&&-1!==artiConst.val[t].indexOf(e)}entryVerify(t,e){if("string"!=typeof t||!Array.isArray(e))throw new Error("Function entryVerify Error!Wrong parameter.");for(let r=0;r<e.length;r++)if(t===e[r]||-1===artiConst.val.entryList.indexOf(e[r]))return!1;return!0}toThousands(t){return(t||0).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")}get MihoyoImYourDaddy(){for(let t=0;t<this.AUSList.length;t++){const e=this.AUSList[t];for(let r=0;r<e.entry.length;r++){const n=e.entry[r];if("critRate"===n[0]||"critDMG"===n[0])for(;e.level<20;)this.upgrade(t,n[0],3)}}return"Yes,you are!"}setLocalStorage(t,e){"object"==typeof e&&(e=JSON.stringify(e)),"number"==typeof e&&(e=e.toString());let r=window.localStorage;if(!r)throw new Error("The browser does not support LocalStorage.");r.setItem(t,e)}get version(){return this.__version__}get LSkey(){return this.__localStorageKey__}get AUSList(){return this.__AUSList__}set AUSList(t){Array.isArray(t)&&(t.length>this.__maxResults__&&(t.length=this.__maxResults__,console.log(`Warning - The maximum length of the artifacts list is ${this.__maxResults__}.`)),this.__AUSList__.length=0,this.__AUSList__=t,this.setLocalStorage(this.__localStorageKey__,this.__AUSList__),console.log("%cSet new Artifacts list success.","color:rgb(144,82,41)"))}}const artiConst=new ArtifactConst,ArtifactsSim=new ArtifactsFunction_class;console.log("%cArtifactsUpgradeSim is running.Learn more: https://github.com/DioMao/genshin_ArtifactsUpgradeSim_js","color:rgb(144,82,41)"),versionCheck();